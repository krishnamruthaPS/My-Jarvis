<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Jarvis - AI Assistant</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: #f5f7fa;
        color: #2d3748;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .header {
        background: #ffffff;
        border-bottom: 1px solid #e2e8f0;
        padding: 20px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .logo {
        font-size: 24px;
        font-weight: 700;
        background: linear-gradient(135deg, #1dd1a1 0%, #10ac84 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        letter-spacing: -0.5px;
      }

      .status-badge {
        font-size: 11px;
        background: #2d3748;
        padding: 4px 12px;
        border-radius: 20px;
        color: #90ee90;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .status-dot {
        width: 6px;
        height: 6px;
        background: #90ee90;
        border-radius: 50%;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .main-container {
        display: flex;
        flex: 1;
        max-width: 1400px;
        margin: 0 auto;
        width: 100%;
        gap: 20px;
        padding: 20px;
      }

      .sidebar {
        width: 320px;
        background: #ffffff;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        padding: 24px;
        height: fit-content;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      .sidebar-title {
        font-size: 14px;
        font-weight: 700;
        text-transform: uppercase;
        color: #4a5568;
        margin-bottom: 16px;
        letter-spacing: 0.5px;
      }

      .sidebar-section {
        margin-bottom: 24px;
      }

      .sidebar-section:last-child {
        margin-bottom: 0;
      }

      .ingest-form {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .form-label {
        font-size: 12px;
        font-weight: 600;
        color: #aaa;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .form-input {
        padding: 10px 12px;
        background: #f7fafc;
        border: 1px solid #cbd5e0;
        border-radius: 6px;
        color: #2d3748;
        font-size: 13px;
        font-family: "Monaco", "Courier New", monospace;
        transition: all 0.2s;
      }

      .form-input:focus {
        outline: none;
        border-color: #ff6b6b;
        box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        background: #ffffff;
      }

      .btn {
        padding: 10px 16px;
        border: none;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
      }

      .btn-primary:active {
        transform: translateY(0);
      }

      .sidebar-hint {
        font-size: 12px;
        color: #718096;
        margin-top: 8px;
        line-height: 1.5;
      }

      .message {
        padding: 12px;
        border-radius: 6px;
        font-size: 12px;
        margin-bottom: 12px;
      }

      .message.success {
        background: #f0fff4;
        border: 1px solid #9ae6b4;
        color: #22543d;
      }

      .message.error {
        background: #fff5f5;
        border: 1px solid #fc8181;
        color: #742a2a;
      }

      .chat-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: #ffffff;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 24px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        background: #ffffff;
      }

      .chat-messages::-webkit-scrollbar {
        width: 6px;
      }

      .chat-messages::-webkit-scrollbar-track {
        background: transparent;
      }

      .chat-messages::-webkit-scrollbar-thumb {
        background: #cbd5e0;
        border-radius: 3px;
      }

      .chat-messages::-webkit-scrollbar-thumb:hover {
        background: #a0aec0;
      }

      .message-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .message-user {
        display: flex;
        justify-content: flex-end;
      }

      .message-content {
        max-width: 80%;
        padding: 12px 16px;
        border-radius: 12px;
        word-wrap: break-word;
        line-height: 1.5;
        font-size: 14px;
      }

      .message-user .message-content {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        color: white;
        border-bottom-right-radius: 4px;
      }

      .message-bot {
        display: flex;
        justify-content: flex-start;
      }

      .message-bot .message-content {
        background: #edf2f7;
        color: #2d3748;
        border-bottom-left-radius: 4px;
      }

      .message-bot.loading .message-content {
        background: #ffe6e6;
        color: #ee5a6f;
        font-style: italic;
      }

      .message-bot.error .message-content {
        background: rgba(244, 67, 54, 0.1);
        color: #f44336;
        border: 1px solid rgba(244, 67, 54, 0.2);
      }

      .typing-indicator {
        display: flex;
        gap: 4px;
        align-items: flex-end;
      }

      .typing-dot {
        width: 8px;
        height: 8px;
        background: #666;
        border-radius: 50%;
        animation: typing 1.4s infinite;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }

      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typing {
        0%,
        60%,
        100% {
          opacity: 0.3;
          transform: translateY(0);
        }
        30% {
          opacity: 1;
          transform: translateY(-8px);
        }
      }

      .chat-input-area {
        border-top: 1px solid #e2e8f0;
        padding: 20px 24px;
        background: #f9fafb;
      }

      .chat-input-wrapper {
        display: flex;
        gap: 12px;
        align-items: flex-end;
      }

      #query-input {
        flex: 1;
        padding: 12px 16px;
        background: #ffffff;
        border: 1px solid #cbd5e0;
        border-radius: 8px;
        color: #2d3748;
        font-size: 14px;
        font-family: inherit;
        resize: none;
        max-height: 120px;
        transition: all 0.2s;
      }

      #query-input:focus {
        outline: none;
        border-color: #ff6b6b;
        box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
      }

      #query-input::placeholder {
        color: #a0aec0;
      }

      .chat-btn {
        padding: 12px 24px;
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: all 0.2s;
        white-space: nowrap;
      }

      .chat-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
      }

      .chat-btn:active {
        transform: translateY(0);
      }

      .chat-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: #a0aec0;
        text-align: center;
        gap: 12px;
      }

      .empty-state-icon {
        font-size: 48px;
        opacity: 0.5;
      }

      .empty-state-text {
        font-size: 14px;
        color: #718096;
      }

      @media (max-width: 1024px) {
        .main-container {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
        }

        .message-content {
          max-width: 100%;
        }
      }

      @media (max-width: 768px) {
        .header {
          padding: 16px 20px;
        }

        .main-container {
          padding: 12px;
        }

        .chat-messages {
          padding: 16px;
        }

        .chat-input-area {
          padding: 16px;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="header-left">
        <div class="logo">MY JARVIS</div>
        <div class="status-badge">
          <span class="status-dot"></span>
          Active
        </div>
      </div>
    </div>

    <div class="main-container">
      <div class="sidebar">
        <div class="sidebar-section">
          <div class="sidebar-title">üìÅ Upload Documents</div>
          <form
            method="post"
            action="/upload"
            enctype="multipart/form-data"
            class="ingest-form"
          >
            <input
              type="file"
              id="file_upload"
              name="file"
              class="form-input"
              accept=".pdf,.txt,.md"
              style="padding: 8px"
            />
            <button type="submit" class="btn btn-primary">Upload File</button>
          </form>
          {% if message %}
          <div
            class="message {% if 'Successfully' in message %}success{% elif 'Error' in message or 'Failed' in message %}error{% endif %}"
          >
            {{ message }}
          </div>
          {% endif %}
        </div>
      </div>

      <div class="chat-container">
        <div class="chat-messages" id="chat-messages">
          <div class="empty-state">
            <div class="empty-state-icon">üí¨</div>
            <div class="empty-state-text">start asking questions</div>
          </div>
        </div>

        <div class="chat-input-area">
          <form id="query-form" class="chat-input-wrapper">
            <textarea
              id="query-input"
              placeholder="Ask anything about your documents..."
              rows="1"
            ></textarea>
            <button type="submit" class="chat-btn" id="send-btn">Send</button>
          </form>
        </div>
      </div>
    </div>

    <script>
      (function () {
        const form = document.getElementById("query-form");
        const input = document.getElementById("query-input");
        const chatMessages = document.getElementById("chat-messages");
        const sendBtn = document.getElementById("send-btn");
        let isLoading = false;

        // Auto-resize textarea
        input.addEventListener("input", function () {
          this.style.height = "auto";
          this.style.height = Math.min(this.scrollHeight, 120) + "px";
        });

        // Allow Enter to send, Shift+Enter for new line
        input.addEventListener("keydown", function (e) {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            form.dispatchEvent(new Event("submit"));
          }
        });

        function clearEmpty() {
          const emptyState = chatMessages.querySelector(".empty-state");
          if (emptyState) emptyState.remove();
        }

        function addMessage(text, isUser, isError = false) {
          clearEmpty();
          const messageGroup = document.createElement("div");
          messageGroup.className = "message-group";

          const messageDiv = document.createElement("div");
          messageDiv.className = isUser
            ? "message-user"
            : `message-bot ${isError ? "error" : ""}`;

          const content = document.createElement("div");
          content.className = "message-content";

          if (isError) {
            content.textContent = text;
          } else {
            content.textContent = text;
          }

          messageDiv.appendChild(content);
          messageGroup.appendChild(messageDiv);
          chatMessages.appendChild(messageGroup);
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addLoadingMessage() {
          clearEmpty();
          const messageGroup = document.createElement("div");
          messageGroup.className = "message-group";
          messageGroup.id = "loading-message";

          const messageDiv = document.createElement("div");
          messageDiv.className = "message-bot loading";

          const content = document.createElement("div");
          content.className = "message-content";

          const typing = document.createElement("div");
          typing.className = "typing-indicator";
          typing.innerHTML =
            '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';

          content.appendChild(typing);
          messageDiv.appendChild(content);
          messageGroup.appendChild(messageDiv);
          chatMessages.appendChild(messageGroup);
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeLoadingMessage() {
          const loading = document.getElementById("loading-message");
          if (loading) loading.remove();
        }

        form.addEventListener("submit", async function (e) {
          e.preventDefault();
          const q = input.value.trim();

          if (!q || isLoading) return;

          isLoading = true;
          sendBtn.disabled = true;

          addMessage(q, true);
          input.value = "";
          input.style.height = "auto";

          addLoadingMessage();

          try {
            const resp = await fetch("/query", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ query_text: q }),
            });

            const data = await resp.json().catch(() => null);
            removeLoadingMessage();

            if (resp.ok && data && data.success) {
              addMessage(data.answer, false);
            } else if (data && data.error) {
              addMessage("Error: " + data.error, false, true);
            } else {
              addMessage("An error occurred. Please try again.", false, true);
            }
          } catch (err) {
            removeLoadingMessage();
            addMessage("Connection error: " + err.message, false, true);
          }

          isLoading = false;
          sendBtn.disabled = false;
          input.focus();
        });
      })();
    </script>
  </body>
</html>
